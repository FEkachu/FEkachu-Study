## 1. 스코프란 무엇인가?

스코프란 특정 언어가 어디서 어떻게 변수를 찾는가를 결정하는 규칙의 집합이다.

그렇다면 그 규칙의 집합의 요소는 무엇일까? 바로 렉시컬 스코프(정적 스코프)와 동적 스코프가 있다. 이 중 자바스크립트를 비롯한 많은 언어는 렉시컬 스코프를 채택하였다.

이런 규칙은 어디에 정의되어있길래 컴파일 과정에서 해당 규칙을 사용할 수 있는 것일까? 처음에는 규칙을 물리적인 실체로 생각하고 어딘가에 저장이 돼있을거라고 가정하고 검색을 했다. 하지만 스코프는 컴파일러의 구현 결과의 특성일 뿐이며, 자바스크립트 엔진이 코드를 컴파일하는 규칙 중 하나라고 볼 수 있었다. 그 규칙이 만약 실제 코드 안에 있다면 그 또한 비효율적인 일일 것이다.

## 2. 스코프는 언제 결정되는가?

위에서 스코프란 규칙의 집합의 요소로는 렉시컬 스코프와 동적 스코프가 있다고 하였다. 렉시컬 스코프는 함수 정의가 평가되는 시점에 상위 스코프가 정적으로 결정된다. 동적 스코프는 함수가 호출되는 시점에 동적으로 상위 스코프를 결정한다. 자바스크립트는 렉시컬 스코프를 채택하였으므로 스코프는 함수를 호출하는 시점이 아닌 함수가 선언되는 시점에 결정된다고 볼 수 있다.

## 3. 스코프는 중첩된다.

하나의 블록이나 함수는 다른 블록이나 함수 안에 중첩될 수 있으므로 스코프 또한 다른 스코프 안에 중첩될 수 있을 것이다. 그럼 이 중첩된 스코프 속에서 자바스크립트 엔진은 어떠한 규칙으로 변수를 찾을 것인가.

일단 가장 가까운 스코프에서 변수를 찾는다. 그 스코프에서 변수를 찾지 못한다면 다음으로 가까운 스코프에서 변수를 찾고 이 과정을 반복하여 전역 스코프까지 살펴본 후에 변수를 찾지 못한다면 검색을 그대로 종료한다. 이렇게 된다면 자바스크립트 엔진은 `ReferenceError`를 발생시킨다. 더 자세한 내용은 다음 단락에서 설명한다.

## 4. 스코프와 실행 컨텍스트

MDN 용어 사전에 따르면 스코프란 현재 실행되는 컨텍스트라고 한다. 여기서 컨텍스트는 값과 표현식이 표현되거나 참조될 수 있음을 의미한다. 만약 변수 또는 다른 표현식이 해당 스코프 내에 있지 않다면 사용할 수 없다.

실행 컨텍스트(Execution Context)는 scope, hoisting, this, function, closure 등의 동작원리를 담고 있는 자바스크립트의 핵심원리로 ECMAScript에 따르면 실행 가능한 코드를 형상화하고 구분하는 추상적인 개념이라고 정의한다. 좀 더 쉽게 말하자면 실행 컨텍스트는 실행 가능한 코드가 실행되기 위해 필요한 환경이다.

그렇다면 다시 첫 줄로 돌아가서 MDN 용어 사전이 정의한 스코프를 살펴보겠다. 스코프란 현재 실행되는 컨텍스트로, 그렇다는건 스코프란 현재 실행중인 코드의 환경이라고 볼 수 있다. 따라서 그 환경에서만 접근할 수 있는 변수나 함수가 존재할 수 있고, 어떤 환경 안에 중첩되어있다면 상위로 중첩되어있는 환경의 변수나 함수에도 접근할 수 있는 것이다.

```jsx
const outer = () => {
	const name = 'wonse';
	const inner = () => {
		console.log(name); // wonse
	};
	inner();
};
```

## 5. 스코프 체인

스코프 체인은 전역 객체와 중첩된 함수의 스코프의 레퍼런스를 차례로 저장하고 있는 일종의 리스트다. 스코프 체인은 식별자 중에서 객체(전역 객체 제외)의 프로퍼티가 아닌 식별자, 즉 변수를 검색하는 메커니즘이다. 위 코드에서 중첩된 inner() 함수에서 name에 접근할 수 있었던 매커니즘이 바로 스코프 체인이다.

![Untitled](https://user-images.githubusercontent.com/62709718/178267241-a747e39b-e2bc-4a4b-8ac1-874a99376356.png)

실행 컨텍스트가 생성된 이후 가장 먼저 스코프 체인의 생성과 초기화가 실행되며 이때 스코프 체인은 전역 객체의 레퍼런스를 포함하는 리스트가 된다.

## 6. 렉시컬 스코핑(Lexical Scoping)

```jsx
function init() {
    var name = "Mozilla"; // name is a local variable created by init
    function displayName() { // displayName() is the inner function, a closure
        alert (name); // displayName() uses variable declared in the parent function    
    }
    displayName();    
}
init();
```

위 코드는 MDN에 소개되어있는 렉시컬 스코핑의 한 예이다. 단어 `Lexical`은 단순 해석하면 어휘라는 뜻으로 렉시컬 스코핑 과정에서 변수가 어디에서 사용 가능한지 알기 위해 그 변수가 소스코드 내 어디에서 선언되었는지 고려한다는 것을 의미하고 그 사실을 나타낸다.

***참고***

[A Simple Explanation of Scope in JavaScript](https://dmitripavlutin.com/javascript-scope/)

[Execution Context | PoiemaWeb](https://poiemaweb.com/js-execution-context)

[스코프 - 용어 사전 | MDN](https://developer.mozilla.org/ko/docs/Glossary/Scope)

[클로저 - JavaScript | MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Closures)
